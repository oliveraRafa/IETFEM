angular.module("IETFEM",[]).controller("mainCtrl",["$scope","ModelService","DeformedService","SpaceService","leftMenuService","PtoSelecService","LineaSelecService","DefaultsService","$timeout",function(e,t,o,n,a,r,s,c,l){function d(){x=document.getElementById("viewport"),M=$("#viewportContainer").width(),y=window.innerHeight-53,I=new THREE.PerspectiveCamera(60,M/y,1,1e3),I.position.z=10,I.near=.1,I.up=new THREE.Vector3(0,0,1),I.lookAt(new THREE.Vector3(0,0,0)),S=new THREE.OrbitControls(I,x),S.damping=.1,S.addEventListener("change",E),e.scene=new THREE.Scene,z=new THREE.GridHelper(100,1),z.rotation.x=Math.PI/2,z.setColors(new THREE.Color(8618883),new THREE.Color(13684944)),z.position.set(0,0,0),e.scene.add(z);var t=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,0)),o=3;e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(1,0,0),t,o,16711680)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),t,o,65280)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,0,1),t,o,255)),rendererStats=new THREEx.RendererStats,rendererStats.domElement.style.position="absolute",rendererStats.domElement.style.left="0px",rendererStats.domElement.style.bottom="0px",F=new THREE.WebGLRenderer({antialiasing:!1}),F.setPixelRatio(window.devicePixelRatio),F.setSize(M,y),F.setClearColor(15658734,1),x.appendChild(F.domElement),window.addEventListener("resize",p,!1),window.addEventListener("mouseup",h,!1),window.addEventListener("mousedown",f,!1),window.addEventListener("keyup",m,!1),window.addEventListener("mousemove",g,!1),viewportAxis=document.getElementById("viewportAxis"),b=new THREE.WebGLRenderer,b.setSize($("#viewportAxisContainer").width(),$("#viewportAxisContainer").height()),b.setClearColor(15790320,1),viewportAxis.appendChild(b.domElement),e.sceneAxis=new THREE.Scene,w=new THREE.PerspectiveCamera(10,$("#viewportAxisContainer").width()/$("#viewportAxisContainer").height(),1,1e3),w.up=I.up,w.position.y=10,axes2=new THREE.AxisHelper(5),e.sceneAxis.add(axes2),e.addParticle(0,0,0),u(),$(function(){$('[data-toggle="tooltip"]').tooltip()})}function u(){$(".botonMenuIzq").css("padding","0"),$(".botonMenuIzq").width($("#menuIzquierda").width()),$(".botonMenuIzq").height($("#menuIzquierda").width())}function p(){M=$("#viewportContainer").width(),y=window.innerHeight-53,I.aspect=M/y,I.updateProjectionMatrix(),F.setSize($("#viewportContainer").width(),window.innerHeight-53),E(),u()}function m(t){if(27==t.keyCode)if(a.getSelecting()){var o=r.getPuntoReal(),i=s.getLineaReal();if(null!=o){var l=n.getScenePointById(o.sceneId,e.scene);l.material=c.getMaterialNegro(),r.resetPuntoSeleccionado()}if(null!=i){var d=n.getSceneLineById(i.sceneId,e.scene);d.material=c.getMaterialNegro(),s.resetLineaSeleccionada()}E(),a.setLastSelected(null),e.$apply()}else a.setAddingLines(!1),a.setAddingNodes(!1),a.setAddingGrillas(!1),a.setSelecting(!0),e.$apply()}function f(e){0==e.button&&(R=e.clientX,H=e.clientY)}function g(t){if("CROSSLINK_INPUT"==e.programMode){M=$("#viewportContainer").width(),y=window.innerHeight-53,offsetIzq=$("#menuIzquierda").outerWidth(!0);var o=new THREE.Vector3((t.clientX-offsetIzq)/M*2-1,2*-((t.clientY-53)/y)+1,.5);o.unproject(I);var n=new THREE.Raycaster(I.position,o.sub(I.position).normalize()),a=e.spaceAux.scenePoints.concat(e.spaceAux.sceneLines),i=n.intersectObjects(a);i.length>0?(idIntersected=i[0].object.id,P!=i[0].object&&r.getPunto().sceneId!=idIntersected&&s.getLinea().sceneId!=idIntersected&&L!=idIntersected&&(null!=P&&(P.material=c.getMaterialNegro()),P=i[0].object,i[0].object.material=c.getMaterialResaltado())):(null!=P&&r.getPunto().sceneId!=P.id&&s.getLinea().sceneId!=P.id&&L!=P.id&&null!=P&&(P.material=c.getMaterialNegro()),P=null)}else null!=P?P.material=c.getMaterialNegro():P=null;E()}function h(o){M=$("#viewportContainer").width(),y=window.innerHeight-53,offsetIzq=$("#menuIzquierda").outerWidth(!0);var i=new THREE.Vector3((o.clientX-offsetIzq)/M*2-1,2*-((o.clientY-53)/y)+1,.5);i.unproject(I);var l=new THREE.Raycaster(I.position,i.sub(I.position).normalize()),d=!1;if(a.getSelecting()&&"CROSSLINK_INPUT"===e.programMode){var u,p=l.intersectObjects(e.spaceAux.scenePoints);p.length>0&&(u=t.getPointBySceneId(p[0].object.id,e.model),r.getPunto().id!=u.id?(0!=r.getPunto().sceneId&&(n.getScenePointById(r.getPunto().sceneId,e.scene).material=c.getMaterialNegro()),r.setPunto(u),p[0].object.material=c.getMaterialSeleccion()):(r.resetPuntoSeleccionado(),p[0].object.material=c.getMaterialNegro()),d=!0,r.resetForm(),e.$apply())}if(!d&&a.getSelecting()){var m,f=l.intersectObjects(e.spaceAux.sceneLines);f.length>0&&(m=t.getLineBySceneId(f[0].object.id,e.model),s.getLinea().id!=m.id?(0!=s.getLinea().sceneId&&(n.getSceneLineById(s.getLinea().sceneId,e.scene).material=c.getMaterialNegro()),s.setLinea(m),f[0].object.material=c.getMaterialSeleccion()):(s.resetLineaSeleccionada(),f[0].object.material=c.getMaterialNegro()),s.resetForm(),e.$apply())}var g=l.intersectObjects(e.spaceAux.helpObjects.grilla);if(g.length>0&&!a.getAddingLines()&&a.getAddingNodes()&&!e.yaExistePuntoCoords(g[0].object.position.x,g[0].object.position.y,g[0].object.position.z)){var h=n.drawPoint(g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,e.scene,e.spaceAux.scenePoints,c.getMaterialNegro(),null);t.addPointToModel(g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,h,e.model),e.setScaleValues(g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,!1)}var g=l.intersectObjects(e.spaceAux.scenePoints);if(g.length>0&&a.getAddingLines()&&!a.getAddingNodes()&&t.isInModel(g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,e.model))if(null==j)j={},j.x=g[0].object.position.x,j.y=g[0].object.position.y,j.z=g[0].object.position.z,L=g[0].object.id,g[0].object.material=c.getMaterialCreacionLinea(),g[0].object.geometry=new THREE.SphereGeometry(.15,4,4);else{if(j.x!=g[0].object.position.x||j.y!=g[0].object.position.y||j.z!=g[0].object.position.z){var v=n.drawLine(j.x,j.y,j.z,g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,c.getMaterialNegro(),.035,e.scene,e.spaceAux.sceneLines);t.addLineToModel(j.x,j.y,j.z,g[0].object.position.x,g[0].object.position.y,g[0].object.position.z,v,e.model)}n.getScenePointById(L,e.scene).material=c.getMaterialNegro(),n.getScenePointById(L,e.scene).geometry=new THREE.SphereGeometry(.1,4,4),L=0,j=null}E()}setTimeout(function(){document.getElementById("splash").className+="fadeOut animated"},500),setTimeout(function(){document.getElementById("splash").style.display="none"},2e3);var E=function(){w.position.copy(I.position),w.position.sub(S.target),w.position.setLength(10),w.up=I.up,w.lookAt(e.sceneAxis.position),rendererStats.update(F),F.render(e.scene,I),b.render(e.sceneAxis,w)};e.getInfoPuntoInterfaz=function(){e.puntoId=puntoSeleccionado.id,e.xCondicion=puntoSeleccionado.xCondicion},e.addGrid=function(){var o,a,r=t.createGridInfo(e.model.helpObjects.grillas),i=c.getMaterialGrilla();for(o=0;o<e.largoY*e.separatorY;o+=e.separatorY){for(a=0;a<e.largoX*e.separatorX;a+=e.separatorX){var s=n.drawLine(e.posX+a,e.posY+o,e.posZ,e.posX+a,e.posY+o,e.posZ+(e.largoZ-1)*e.separatorZ,i,.01,e.scene,null,!0);t.addGridLineToModel(e.posX+a,e.posY+o,e.posZ,e.posX+a,e.posY+o,e.posZ+(e.largoZ-1)*e.separatorZ,s,r)}for(a=0;a<e.largoZ*e.separatorZ;a+=e.separatorZ){var s=n.drawLine(e.posX,e.posY+o,e.posZ+a,e.posX+(e.largoX-1)*e.separatorX,e.posY+o,e.posZ+a,i,.01,e.scene,null,!0);for(t.addGridLineToModel(e.posX,e.posY+o,e.posZ+a,e.posX+(e.largoX-1)*e.separatorX,e.posY+o,e.posZ+a,s,r),k=0;k<e.largoX*e.separatorX;k+=e.separatorX){var l=c.getEsferaEstandar(),d=c.getMaterialGrilla(),u=new THREE.Mesh(l,d);if(u.position.x=e.posX+k,u.position.y=e.posY+o,u.position.z=e.posZ+a,e.scene.add(u),t.addGridPointToModel(e.posX+k,e.posY+o,e.posZ+a,u.id,r),e.spaceAux.helpObjects.grilla.push(u),o>0){var s=n.drawLine(e.posX+k,e.posY+o-e.separatorY,e.posZ+a,e.posX+k,e.posY+o,e.posZ+a,i,.01,e.scene,null,!0);t.addGridLineToModel(e.posX+k,e.posY+o-e.separatorY,e.posZ+a,e.posX+k,e.posY+o,e.posZ+a,s,r)}}}}E(),e.grillaForm.$setPristine(),e.posX=void 0,e.posY=void 0,e.posZ=void 0,e.largoX=void 0,e.separatorX=void 0,e.largoY=void 0,e.separatorY=void 0,e.largoZ=void 0,e.separatorZ=void 0,e.model.helpObjects.idLastGrilla++};var v=function(){for(var t=0;t<e.model.points.length&&(null==e.fuerzas.escala.maxX||null==e.fuerzas.escala.minX||null==e.fuerzas.escala.maxY||null==e.fuerzas.escala.minY||null==e.fuerzas.escala.maxZ||null==e.fuerzas.escala.minZ);t++){var o=e.model.points[t];e.setScaleValues(o.coords.x,o.coords.y,o.coords.z,!1)}};e.setScaleValues=function(t,o,n,a){if(a){var r=!1;(t==e.fuerzas.escala.maxX||t==e.fuerzas.escala.minX)&&(e.fuerzas.escala.maxX=null,e.fuerzas.escala.minX=null,r=!0),(o==e.fuerzas.escala.maxY||o==e.fuerzas.escala.minY)&&(e.fuerzas.escala.maxY=null,e.fuerzas.escala.minY=null,r=!0),(n==e.fuerzas.escala.maxZ||n==e.fuerzas.escala.minZ)&&(e.fuerzas.escala.maxZ=null,e.fuerzas.escala.minZ=null,r=!0),r&&v()}else null!=e.fuerzas.escala.maxX&&t>e.fuerzas.escala.maxX?e.fuerzas.escala.maxX=t:null!=e.fuerzas.escala.minX&&t<e.fuerzas.escala.minX?e.fuerzas.escala.minX=t:(e.fuerzas.escala.maxX=t,e.fuerzas.escala.minX=t),null!=e.fuerzas.escala.maxY&&o>e.fuerzas.escala.maxY?e.fuerzas.escala.maxY=o:null!=e.fuerzas.escala.minY&&o<e.fuerzas.escala.minY?e.fuerzas.escala.minY=o:(e.fuerzas.escala.maxY=o,e.fuerzas.escala.minY=o),null!=e.fuerzas.escala.maxZ&&n>e.fuerzas.escala.maxZ?e.fuerzas.escala.maxZ=n:null!=e.fuerzas.escala.minZ&&n<e.fuerzas.escala.minZ?e.fuerzas.escala.minZ=n:(e.fuerzas.escala.maxZ=n,e.fuerzas.escala.minZ=n)},e.addPoint=function(){var o=new THREE.MeshBasicMaterial({color:0});if(0==n.getScenePointIdByCoords(e.posX,e.posY,e.posZ,e.scene)){var a=n.drawPoint(e.posX,e.posY,e.posZ,e.scene,e.spaceAux.scenePoints,o,e.spaceAux.helpObjects.grilla);t.addPointToModel(e.posX,e.posY,e.posZ,a,e.model),e.setScaleValues(e.posX,e.posY,e.posZ,!1),E(),e.nodoCoordenadaForm.$setPristine(),e.posX=void 0,e.posY=void 0,e.posZ=void 0}},e.yaExistePunto=function(){return 0==t.getPointIdByCoords(e.posX,e.posY,e.posZ,e.model)?!1:!0},e.yaExistePuntoCoords=function(o,n,a){return 0==t.getPointIdByCoords(o,n,a,e.model)?!1:!0},e.addParticle=function(t,o,n){var a=new THREE.Geometry,r=new THREE.Vector3(t,o,n);a.vertices.push(r);var i=new THREE.PointCloudMaterial({color:0,size:.2}),s=new THREE.PointCloud(a,i);e.scene.add(s),E()},e.set2D=function(){T=!1,I.position.x=0,I.position.y=10,I.position.z=0,I.lookAt(new THREE.Vector3(0,0,0)),S.removeEventListener("change",E),E()},e.set3D=function(){T=!0,I.position.x=5,I.position.y=10,I.position.z=5,I.lookAt(new THREE.Vector3(0,0,0)),S.addEventListener("change",E),E()},e.modelToText=function(){if(e.validModel=t.validModel(e.model),e.validModel.valid){e.modelText=t.getText(e.model);var o=window.document.createElement("a");o.href=window.URL.createObjectURL(new Blob([e.modelText],{type:"text/txt"})),o.download="model.txt",document.body.appendChild(o),o.click(),document.body.removeChild(o),$("#obtenerTextoModal").modal("hide"),$("#transitionModal").modal("show")}},e.goToDownloadModel=function(){console.log(e.model),e.validModel={valid:!0},$("#obtenerTextoModal").modal("show")},e.goToProcessOutput=function(){$("#transitionModal").modal("hide"),e.futureScale=1,$("#processOutputModal").modal("show")},e.startProcessOutput=function(){e.procesing=!0,setTimeout(e.processOutput,0)},e.processOutput=function(){var a=new FileReader;a.onload=function(){var r=new THREE.LineBasicMaterial({color:2689162,transparent:!0,opacity:.15}),s=a.result,c=(s.slice(0,s.search("RESULTADOS")-1),[]),l=s.search("u_z")+4,d=s.search("Parametros en barras")-2,u=s.slice(l,d).split("\n");for(i=0;i<u.length;i++){var p=u[i].split("	");c.push(p)}var m=[],f=s.search("Tension")+8,g=s.length-1;for(u=s.slice(f,g).split("\n"),i=0;i<u.length;i++)p=u[i].split("	"),m.push(p);var h=0;for(i=0;h<c.length;i++){var v=t.getPointById(i+1,e.model);if(v){var x=parseFloat(c[h][0].split("e")[0])*Math.pow(10,parseFloat(c[h][0].split("e")[1])),M=parseFloat(c[h][1].split("e")[0])*Math.pow(10,parseFloat(c[h][1].split("e")[1])),y=parseFloat(c[h][2].split("e")[0])*Math.pow(10,parseFloat(c[h][2].split("e")[1])),I=parseFloat(v.coords.x)+e.futureScale*x,w=parseFloat(v.coords.y)+e.futureScale*M,S=parseFloat(v.coords.z)+e.futureScale*y,F=n.drawPoint(I,w,S,e.scene,e.spaceAux.scenePoints,r,null);o.addPointToDeformed(v.coords.x,v.coords.z,v.coords.y,x,y,M,v.id,F,e.deformed),h+=1}}for(h=0,i=0;h<m.length;i++){var b=e.model.lines[i];if(b){var T=o.getDeformedPointById(b.start,e.deformed),z=o.getDeformedPointById(b.end,e.deformed),R=parseFloat(T.coords.x)+parseFloat(T.displacements.x),H=parseFloat(T.coords.z)+parseFloat(T.displacements.z),P=parseFloat(T.coords.y)+parseFloat(T.displacements.y),j=parseFloat(z.coords.x)+parseFloat(z.displacements.x),L=parseFloat(z.coords.z)+parseFloat(z.displacements.z),O=parseFloat(z.coords.y)+parseFloat(z.displacements.y),F=n.drawLine(R,H,P,j,L,O,r,.05,e.scene,[]),A=parseFloat(m[h][0].split("e")[0])*Math.pow(10,parseFloat(m[h][0].split("e")[1])),C=parseFloat(m[h][1].split("e")[0])*Math.pow(10,parseFloat(m[h][1].split("e")[1])),N=parseFloat(m[h][2].split("e")[0])*Math.pow(10,parseFloat(m[h][2].split("e")[1]));o.addLineToDeformed(b.start,b.end,b.id,F,A,C,N,e.deformed),h+=1}}e.scaleStructure=e.futureScale,e.scaleStructureAux=e.futureScale,$("#processOutputModal").modal("hide"),e.procesing=!1,e.$apply(),E()},a.readAsText(e.theFile),e.programMode="CROSSLINK_OUTPUT",e.structureView="normal",e.scaleStructure=1,e.structureColors="normal"},e.startImportModel=function(){null!=e.theFile&&(e.importing=!0,setTimeout(e.importModel,0))},e.importModel=function(){e.importing=!0;var o=new FileReader;o.onload=function(){var a=c.getMaterialNegro(),r=o.result;r.replace("/r/n","/n");var s=[],l=r.search("Zs")+4,d=r.search("Conectivity")-3,u=r.slice(l,d).split("\n");for(i=0;i<u.length;i++){for(var p=u[i].split("	"),m=0;m<p.length;m++)p[m]=parseFloat(p[m]/3);s.push(p)}var f=[],g=r.search("end")+5,h=r.length;for(u=r.slice(g,h).split("\n"),i=0;i<u.length;i++)p=u[i].split("	"),f.push(p);for(i=0;i<s.length;i++){var v=n.drawPoint(s[i][0],s[i][1],s[i][2],e.scene,e.spaceAux.scenePoints,a,null);t.addPointToModel(s[i][0],s[i][1],s[i][2],v,e.model),e.setScaleValues(s[i][0],s[i][1],s[i][2],!1)}for(i=0;i<f.length;i++){var x=parseFloat(s[f[i][3]-1][0]),M=parseFloat(s[f[i][3]-1][1]),y=parseFloat(s[f[i][3]-1][2]),I=parseFloat(s[f[i][4]-1][0]),w=parseFloat(s[f[i][4]-1][1]),S=parseFloat(s[f[i][4]-1][2]),v=n.drawLine(x,M,y,I,w,S,c.getMaterialNegro(),.05,e.scene,e.spaceAux.sceneLines);t.addLineToModel(x,M,y,I,w,S,v,e.model)}E(),$("#importModelModal").modal("hide"),e.importing=!1,e.$apply()},o.readAsText(e.theFile)},setFile=function(t){e.theFile=t.files[0]},e.goToSaveModel=function(){e.saveModelOnExit=!0,$("#newModelModal").modal("hide"),$("#saveModelModal").modal("show")},e.saveModel=function(){var t=angular.toJson(e.model),o=window.document.createElement("a");o.href=window.URL.createObjectURL(new Blob([t],{type:"text/txt"})),o.download=e.modelName+".iet",document.body.appendChild(o),o.click(),document.body.removeChild(o),e.saveModelOnExit?(e.saveModelOnExit=!1,e.newModel("#saveModelModal")):$("#saveModelModal").modal("hide")},e.newModel=function(t){s.resetLineaSeleccionada(),r.resetPuntoSeleccionado(),e.fuerzas={visible:!0},e.fuerzas.escala={factorEscala:1,maxModule:1,maxX:null,minX:null,maxY:null,minY:null,maxZ:null,minZ:null},e.supports={visible:!0},e.resortes={visible:!0},e.model.unitForce="XX",e.model.unitLength="XX";for(var o=e.model.points,n=0;o>n;n++)e.model.points.pop();for(var a=e.model.lines.length,n=0;a>n;n++)e.model.lines.pop();for(var i=e.model.materiales.length,n=0;i>n;n++)e.model.materiales.pop();for(var c=e.model.secciones.length,n=0;c>n;n++)e.model.secciones.pop();for(var l=e.model.helpObjects.grillas.length,n=0;l>n;n++)e.model.helpObjects.grillas.pop();e.spaceAux={helpObjects:{}},e.spaceAux.helpObjects.grilla=[],e.spaceAux.scenePoints=[],e.spaceAux.sceneLines=[],e.deformed={},e.deformed.points=[],e.deformed.lines=[],e.programMode="CROSSLINK_INPUT",$(t).modal("hide"),e.scene=new THREE.Scene,z=new THREE.GridHelper(100,1),z.rotation.x=Math.PI/2,z.setColors(new THREE.Color(8618883),new THREE.Color(13684944)),z.position.set(0,0,0),e.scene.add(z);var d=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,0)),u=3;e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(1,0,0),d,u,16711680)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),d,u,65280)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,0,1),d,u,255)),E()},e.startOpenModel=function(){null!=e.theFile&&(e.opening=!0,e.newModel(""),setTimeout(e.openModel,0))},e.openModel=function(){var t=new FileReader;t.onload=function(){e.newModel();var o=t.result,a=angular.fromJson(o);for(e.model.points=a.points,e.model.lines=a.lines,e.model.unitForce=a.unitForce,e.model.unitLength=a.unitLength,r=0;r<a.materiales.length;r++)e.model.materiales.push(a.materiales[r]);for(r=0;r<a.secciones.length;r++)e.model.secciones.push(a.secciones[r]);for(var r=0;r<a.helpObjects.grillas.length;r++){for(var i=a.helpObjects.grillas[r],s=c.getMaterialGrilla(),l=0;l<i.objects.length;l++)if("POINT"==i.objects[l].type){var d=c.getEsferaEstandar(),u=c.getMaterialGrilla(),p=new THREE.Mesh(d,u);p.position.x=i.objects[l].coords.x,p.position.y=i.objects[l].coords.y,p.position.z=i.objects[l].coords.z,e.scene.add(p),e.spaceAux.helpObjects.grilla.push(p),i.objects[l].sceneId=p.id}else{var m=n.drawLine(i.objects[l].start.x,i.objects[l].start.y,i.objects[l].start.z,i.objects[l].end.x,i.objects[l].end.y,i.objects[l].end.z,s,.01,e.scene,null,!0);i.objects[l].sceneId=m}e.model.helpObjects.grillas.push(i)}for(r=0;r<e.model.points.length;r++)e.model.points[r].forceArrowId=0,e.model.points[r].supportXId=0,e.model.points[r].supportYId=0,e.model.points[r].supportZId=0,e.model.points[r].springXId=0,e.model.points[r].springYId=0,e.model.points[r].springZId=0;n.drawModel(e.scene,e.model,e.spaceAux.scenePoints,e.spaceAux.sceneLines,e.spaceAux.helpObjects),$("#openModelModal").modal("hide"),e.$apply(),E()},t.readAsText(e.theFile),e.opening=!1},e.returnToEdit=function(){e.programMode="CROSSLINK_INPUT";for(var t=e.deformed.points,o=0;t>o;o++)e.deformed.points.pop();for(var a=e.model.lines,o=0;a>o;o++)e.deformed.lines.pop();s.resetLineaSeleccionada(),r.resetPuntoSeleccionado(),e.scene=new THREE.Scene,z=new THREE.GridHelper(100,1),z.rotation.x=Math.PI/2,z.setColors(new THREE.Color(8618883),new THREE.Color(13684944)),z.position.set(0,0,0),e.scene.add(z);var i=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,0)),c=3;e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(1,0,0),i,c,16711680)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,1,0),i,c,65280)),e.scene.add(new THREE.ArrowHelper(new THREE.Vector3(0,0,1),i,c,255)),e.spaceAux={helpObjects:{}},e.spaceAux.helpObjects.grilla=[],e.spaceAux.scenePoints=[],e.spaceAux.sceneLines=[],n.drawModel(e.scene,e.model,e.spaceAux.scenePoints,e.spaceAux.sceneLines,e.spaceAux.helpObjects)},e.dibujandoNodos=function(){return a.getAddingNodes()},e.dibujandoGrillas=function(){return a.getAddingGrillas()},e.seleccionando=function(){return a.getSelecting()},e.ultimoSeleccionado=function(){return a.getLastSelected()},e.dibujandoLineas=function(){return a.getAddingLines()},e.viewingOptions=function(){return a.getViewOptions()};var x,M,y,I,w,S,F,b,T,z,R,H,P=null,j=null,L=0;e.fuerzas={visible:!0},e.fuerzas.escala={factorEscala:1,maxModule:1,maxX:null,minX:null,maxY:null,minY:null,maxZ:null,minZ:null},e.supports={visible:!0},e.resortes={visible:!0},e.model={helpObjects:{}},e.model.points=[],e.model.lines=[],e.model.materiales=[],e.model.secciones=[],e.model.unitForce="XX",e.model.unitLength="XX",e.model.helpObjects.grillas=[],e.spaceAux={helpObjects:{}},e.spaceAux.helpObjects.grilla=[],e.spaceAux.scenePoints=[],e.spaceAux.sceneLines=[],e.deformed={},e.deformed.points=[],e.deformed.lines=[],e.programMode="CROSSLINK_INPUT",e.render=E,d(),E()}]),angular.module("IETFEM").controller("editLineCtrl",["$scope","ModelService","LineaSelecService","DefaultsService",function(e,t,o,n){e.miLinea=o.getLinea(),e.misMateriales=e.model.materiales,e.misSecciones=e.model.secciones,0==e.materialDefecto,0==e.seccionDefecto,this.updateDefaults=function(){n.setLineMaterial(e.materialDefecto),n.setLineSection(e.seccionDefecto)},this.updatedDefaults=function(){return e.materialDefecto==n.getLineMaterial()&&e.seccionDefecto==n.getLineSection()?!0:!1},this.updated=function(){var t=o.getLineaReal();return"undefined"!=typeof t&&t.material==e.miLinea.material&&t.section==e.miLinea.section?!0:!1},this.updateLine=function(){var t=o.getLineaReal();o.setInfoLineaForm(e.infoLineaForm),"undefined"!=typeof t&&(t.material=e.miLinea.material,t.section=e.miLinea.section,o.resetForm())},this.existsLineToRemove=function(){return 0!=o.getLinea().id},this.deleteLine=function(){var n=o.getLinea(),a=e.scene.getObjectById(n.sceneId);t.removeLineFromModel(n.id,e.model),t.removeObjFromArray(n.sceneId,e.spaceAux.sceneLines),o.resetLineaSeleccionada(),e.scene.remove(a),e.render(),console.log(e.scene)}}]),angular.module("IETFEM").controller("editOutputCtrl",["$scope","ModelService","DeformedService",function(e,t,o){e.$watch("structureView",function(){"normal"===e.structureView?(t.setModelOpaque(e.scene,e.model),o.setDeformedTransparent(e.scene,e.deformed),e.structureColors="normal"):(t.setModelTransparent(e.scene,e.model),o.setDeformedOpaque(e.scene,e.deformed)),e.render()}),e.$watch("scaleStructure",function(){o.scaleDeformed(e.scene,e.deformed,e.model,e.scaleStructure),e.render()}),e.$watch("structureColors",function(){"normal"!=e.structureColors?o.hideDeformed(e.scene,e.deformed):o.setDeformedTransparent(e.scene,e.deformed),t.colorizeModel(e.scene,e.model,e.deformed,e.structureColors,"normal"!=e.structureView),e.render()}),e.toggleScaleStructure=function(t){isNaN(parseFloat(e.scaleStructure))||(e.scaleStructure=parseFloat(e.scaleStructure)),t?e.scaleStructure=e.scaleStructureAux:(e.scaleStructure>1e3&&(e.scaleStructure=1e3),e.scaleStructureAux=e.scaleStructure)}}]),angular.module("IETFEM").controller("editPointCtrl",["$scope","ModelService","PtoSelecService","SpaceService",function(e,t,o,n){function a(t){for(var o=[],n=0;n<e.model.lines.length;n++)(e.model.lines[n].start==t||e.model.lines[n].end==t)&&o.push(e.model.lines[n]);return o}e.miPunto=o.getPunto(),e.statusFuerzas=e.fuerzas,e.statusSupports=e.supports,e.statusSprings=e.resortes,this.updated=function(){var t=o.getPuntoReal();return"undefined"!=typeof t&&t.xCondicion==e.miPunto.xCondicion&&t.yCondicion==e.miPunto.yCondicion&&t.zCondicion==e.miPunto.zCondicion&&t.xForce==e.miPunto.xForce&&t.yForce==e.miPunto.yForce&&t.zForce==e.miPunto.zForce&&t.xSpring==e.miPunto.xSpring&&t.ySpring==e.miPunto.ySpring&&t.zSpring==e.miPunto.zSpring?!0:!1};this.updatePoint=function(){var t=o.getPuntoReal();if(o.setInfoPuntoForm(e.infoPuntoForm),"undefined"!=typeof t){t.xCondicion=e.miPunto.xCondicion,t.yCondicion=e.miPunto.yCondicion,t.zCondicion=e.miPunto.zCondicion,t.xSpring=parseFloat(e.miPunto.xSpring),t.ySpring=parseFloat(e.miPunto.ySpring),t.zSpring=parseFloat(e.miPunto.zSpring);var a={};a.xForce=parseFloat(e.miPunto.xForce),a.yForce=parseFloat(e.miPunto.yForce),a.zForce=parseFloat(e.miPunto.zForce),t.xForce=parseFloat(e.miPunto.xForce),t.yForce=parseFloat(e.miPunto.yForce),t.zForce=parseFloat(e.miPunto.zForce),e.statusFuerzas.visible&&($("#toggle-forces").trigger("click"),$("#toggle-forces").trigger("click")),e.statusSupports.visible&&(0==parseFloat(t.xCondicion)?(0!=t.supportXId&&n.removeObjectById(t.supportXId,e.scene),idSupport=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!0,!1,!1,e.scene),t.supportXId=idSupport):n.removeObjectById(t.supportXId,e.scene),0==parseFloat(t.yCondicion)?(0!=t.supportYId&&n.removeObjectById(t.supportYId,e.scene),idSupport=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!1,!0,!1,e.scene),t.supportYId=idSupport):n.removeObjectById(t.supportYId,e.scene),0==parseFloat(t.zCondicion)?(0!=t.supportZId&&n.removeObjectById(t.supportZId,e.scene),idSupport=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!1,!1,!0,e.scene),t.supportZId=idSupport):n.removeObjectById(t.supportZId,e.scene)),e.statusSprings.visible&&(0!=parseFloat(t.xSpring)?(0!=t.springXId&&n.removeObjectById(t.springXId,e.scene),0!=parseFloat(t.xCondicion)?(idSpring=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!0,!1,!1,e.scene,!0),t.springXId=idSpring):t.springXId=0):n.removeObjectById(t.springXId,e.scene),0!=parseFloat(t.ySpring)?(0!=t.springYId&&n.removeObjectById(t.springYId,e.scene),0!=parseFloat(t.yCondicion)?(idSpring=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!1,!0,!1,e.scene,!0),t.springYId=idSpring):t.springYId=0):n.removeObjectById(t.springYId,e.scene),0!=parseFloat(t.zSpring)?(0!=t.springZId&&n.removeObjectById(t.springZId,e.scene),0!=parseFloat(t.zCondicion)?(idSpring=n.drawPyramidSupport(t.coords.x,t.coords.y,t.coords.z,!1,!1,!0,e.scene,!0),t.springZId=idSpring):t.springZId=0):n.removeObjectById(t.springZId,e.scene)),o.resetForm(),e.render()}},this.existsPointToRemove=function(){return 0!=o.getPunto().id},this.deleteNode=function(){for(var r=o.getPuntoReal(),i=r.coords.x,s=r.coords.y,c=r.coords.z,l=e.scene.getObjectById(r.sceneId),d=a(r.id),u=0;u<d.length;u++){var p=d[u],m=e.scene.getObjectById(p.sceneId);t.removeLineFromModel(p.id,e.model),t.removeObjFromArray(p.sceneId,e.spaceAux.sceneLines),e.scene.remove(m)}o.resetPuntoSeleccionado(),t.removePointFromModel(r.id,e.model),t.removeObjFromArray(r.sceneId,e.spaceAux.scenePoints),0!=r.forceArrowId&&n.removeObjectById(r.forceArrowId,e.scene),e.scene.remove(l),e.setScaleValues(i,s,c,!0),e.statusFuerzas.visible&&($("#toggle-forces").trigger("click"),$("#toggle-forces").trigger("click")),e.render()}}]),angular.module("IETFEM").controller("leftMenusCtrl",["$scope","leftMenuService","PtoSelecService",function(e,t,o){e.dibujarNodos=function(){t.setAddingLines(!1),t.setAddingNodes(!0),t.setAddingGrillas(!1),t.setSelecting(!1),t.setViewOptions(!1)},e.dibujarLineas=function(){t.setAddingLines(!0),t.setAddingNodes(!1),t.setAddingGrillas(!1),t.setSelecting(!1),t.setViewOptions(!1)},e.dibujarGrillas=function(){t.setAddingLines(!1),t.setAddingNodes(!1),t.setAddingGrillas(!0),t.setSelecting(!1),t.setViewOptions(!1)},e.seleccionar=function(){t.setAddingLines(!1),t.setAddingNodes(!1),t.setAddingGrillas(!1),t.setSelecting(!0),t.setViewOptions(!1)},e.viewOptions=function(){t.setAddingLines(!1),t.setAddingNodes(!1),t.setAddingGrillas(!1),t.setSelecting(!1),t.setViewOptions(!0)},e.seleccionando=function(){return t.getSelecting()},e.dibujandoGrillas=function(){return t.getAddingGrillas()},e.dibujandoNodos=function(){return t.getAddingNodes()},e.dibujandoLineas=function(){return t.getAddingLines()},e.viewingOptions=function(){return t.getViewOptions()}}]),angular.module("IETFEM").controller("MaterialesCtrl",["$scope","ModelService",function(e,t){e.materiales=e.model.materiales,e.nuevoMaterial={},e.aEditarMaterialIndex=null,e.editando=!1,e.nameToRemove="",e.selectedIndex=null,e.existeMaterial=function(){if(e.materiales.length>0)for(var t=0;t<e.materiales.length;t++)if(e.materiales[t].name==e.nuevoMaterial.name)return!0;return!1},e.addMaterial=function(){e.existeMaterial()||(t.addMaterial(e.nuevoMaterial.name,e.nuevoMaterial.youngModule,e.nuevoMaterial.gamma,e.nuevoMaterial.alpha,e.nuevoMaterial.nu,e.model),e.nuevoMaterial={id:0,name:"Nuevo Material",youngModule:0,gamma:0,alpha:0,nu:0},e.materialForm.$setPristine())};var o=function(){for(var t=0;t<e.materiales.length;t++)if(e.materiales[t].name===e.nameToRemove)return t;return-1};e.removeMaterial=function(){null!=e.selectedIndex&&e.materiales.splice(o(e.nameToRemove),1)},e.setMaterialToRemove=function(t,o){e.selectedIndex!=o?(e.nameToRemove=t.name,e.selectedIndex=o,e.aEditarMaterialIndex=null,e.editando=!1):(e.nameToRemove=null,e.selectedIndex=null,e.aEditarMaterialIndex=null,e.editando=!1)},e.getSelectedIndex=function(){return e.selectedIndex},e.editMaterial=function(){null==e.aEditarMaterialIndex?(e.aEditarMaterialIndex=e.selectedIndex,e.editando=!0,e.nuevoMaterial.id=e.materiales[e.selectedIndex].id,e.nuevoMaterial.name=e.materiales[e.selectedIndex].name,e.nuevoMaterial.youngModule=e.materiales[e.selectedIndex].youngModule,e.nuevoMaterial.gamma=e.materiales[e.selectedIndex].gamma,e.nuevoMaterial.alpha=e.materiales[e.selectedIndex].alpha,e.nuevoMaterial.nu=e.materiales[e.selectedIndex].nu):(e.materiales[e.aEditarMaterialIndex].id=e.nuevoMaterial.id,e.materiales[e.aEditarMaterialIndex].name=e.nuevoMaterial.name,e.materiales[e.aEditarMaterialIndex].youngModule=e.nuevoMaterial.youngModule,e.materiales[e.aEditarMaterialIndex].gamma=e.nuevoMaterial.gamma,e.materiales[e.aEditarMaterialIndex].alpha=e.nuevoMaterial.alpha,e.materiales[e.aEditarMaterialIndex].nu=e.nuevoMaterial.nu,e.aEditarMaterialIndex=null,e.editando=!1,e.selectedIndex=null,e.nuevoMaterial={id:0,name:"Nuevo Material",youngModule:0,gamma:0,alpha:0,nu:0})},e.isEditing=function(){return e.editando}}]),angular.module("IETFEM").controller("SeccionesCtrl",["$scope","ModelService",function(e,t){e.secciones=e.model.secciones,e.nuevaSeccion={},e.aEditarSeccionIndex=null,e.editando=!1,e.sectionToRemove=0,e.selectedIndex=null,e.existeSeccion=function(){if(e.secciones.length>0)for(var t=0;t<e.secciones.length;t++)if(e.secciones[t].name==e.nuevaSeccion.name)return!0;return!1},e.addSection=function(){e.existeSeccion()||(t.addSection(e.nuevaSeccion.name,e.nuevaSeccion.section,e.model),e.nuevaSeccion={id:0,section:0,name:"Nueva Seccion"},e.seccionForm.$setPristine())};var o=function(){for(var t=0;t<e.secciones.length;t++)if(e.secciones[t].section===e.sectionToRemove)return t;return-1};e.removeSection=function(){null!=e.selectedIndex&&e.secciones.splice(o(e.sectionToRemove),1)},e.setSectionToRemove=function(t,o){e.selectedIndex!=o?(e.sectionToRemove=t.section,e.selectedIndex=o,e.aEditarSeccionIndex=null,e.editando=!1):(e.sectionToRemove=null,e.selectedIndex=null,e.aEditarSeccionIndex=null,e.editando=!1)},e.getSelectedIndex=function(){return e.selectedIndex},e.editSeccion=function(){null==e.aEditarSeccionIndex?(e.aEditarSeccionIndex=e.selectedIndex,e.editando=!0,e.nuevaSeccion.section=e.secciones[e.selectedIndex].section,e.nuevaSeccion.name=e.secciones[e.selectedIndex].name):(e.secciones[e.aEditarSeccionIndex].section=e.nuevaSeccion.section,e.secciones[e.aEditarSeccionIndex].name=e.nuevaSeccion.name,e.aEditarSeccionIndex=null,e.editando=!1,e.selectedIndex=null,e.nuevaSeccion={section:0,name:"Nueva Seccion"})},e.isEditing=function(){return e.editando}}]),angular.module("IETFEM").controller("viewOptionsInputCntrl",["$scope","ModelService","SpaceService",function(e,t,o){e.gridInfos=e.model.helpObjects.grillas,e.statusFuerzas=e.fuerzas,e.auxFactor=100,e.statusSupports=e.supports,e.statusSprings=e.resortes,e.toggleGrid=function(t){for(var n=0;n<e.gridInfos.length;n++)if(e.gridInfos[n].gridId==t.gridId)for(var a=0;a<e.gridInfos[n].objects.length;a++)o.hideShowObject(e.gridInfos[n].objects[a].sceneId,t.viewStatus,e.scene);e.render()};var n=function(){for(var t=0,o=0;o<e.model.points.length;o++){var n=e.model.points[o];if(0!=n.xForce||0!=n.yForce||0!=n.zForce){var a=n.xForce,r=n.yForce,i=n.zForce,s=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)+Math.pow(i,2));s>t&&(t=s)}}return t};e.toggleForces=function(t){if(isNaN(parseFloat(e.statusFuerzas.escala.factorEscala))||(e.statusFuerzas.escala.factorEscala=parseFloat(e.statusFuerzas.escala.factorEscala)),t?e.auxFactor>=0&&e.auxFactor<=10?e.statusFuerzas.escala.factorEscala=.1:e.auxFactor>10&&e.auxFactor<=20?e.statusFuerzas.escala.factorEscala=.2:e.auxFactor>20&&e.auxFactor<=30?e.statusFuerzas.escala.factorEscala=.3:e.auxFactor>30&&e.auxFactor<=40?e.statusFuerzas.escala.factorEscala=.4:e.auxFactor>40&&e.auxFactor<=50?e.statusFuerzas.escala.factorEscala=.5:e.auxFactor>50&&e.auxFactor<=60?e.statusFuerzas.escala.factorEscala=.6:e.auxFactor>60&&e.auxFactor<=70?e.statusFuerzas.escala.factorEscala=.7:e.auxFactor>70&&e.auxFactor<=80?e.statusFuerzas.escala.factorEscala=.8:e.auxFactor>80&&e.auxFactor<=90?e.statusFuerzas.escala.factorEscala=.9:e.auxFactor>90&&e.auxFactor<=100?e.statusFuerzas.escala.factorEscala=1:e.statusFuerzas.escala.factorEscala=e.auxFactor-100:e.statusFuerzas.escala.factorEscala>=0&&e.statusFuerzas.escala.factorEscala<=.1?e.auxFactor=0:e.statusFuerzas.escala.factorEscala>=.1&&e.statusFuerzas.escala.factorEscala<=.2?e.auxFactor=10:e.statusFuerzas.escala.factorEscala>=.2&&e.statusFuerzas.escala.factorEscala<=.3?e.auxFactor=20:e.statusFuerzas.escala.factorEscala>=.3&&e.statusFuerzas.escala.factorEscala<=.4?e.auxFactor=30:e.statusFuerzas.escala.factorEscala>=.4&&e.statusFuerzas.escala.factorEscala<=.5?e.auxFactor=40:e.statusFuerzas.escala.factorEscala>=.5&&e.statusFuerzas.escala.factorEscala<=.6?e.auxFactor=50:e.statusFuerzas.escala.factorEscala>=.6&&e.statusFuerzas.escala.factorEscala<=.7?e.auxFactor=60:e.statusFuerzas.escala.factorEscala>=.7&&e.statusFuerzas.escala.factorEscala<=.8?e.auxFactor=70:e.statusFuerzas.escala.factorEscala>=.8&&e.statusFuerzas.escala.factorEscala<=.9?e.auxFactor=80:e.statusFuerzas.escala.factorEscala>=.9&&e.statusFuerzas.escala.factorEscala<=1?e.auxFactor=100:(e.statusFuerzas.escala.factorEscala>100&&(e.statusFuerzas.escala.factorEscala=100),
e.auxFactor=e.statusFuerzas.escala.factorEscala+100),e.statusFuerzas.visible){if(null!=e.fuerzas.escala.maxX){var a=Math.sqrt(Math.pow(e.fuerzas.escala.maxX-e.fuerzas.escala.minX,2)),r=Math.sqrt(Math.pow(e.fuerzas.escala.maxY-e.fuerzas.escala.minY,2)),i=Math.sqrt(Math.pow(e.fuerzas.escala.maxZ-e.fuerzas.escala.minZ,2)),s=Math.max(a,r,i);e.fuerzas.escala.maxModule=.2*s,e.fuerzas.escala.maxModule<1&&(e.fuerzas.escala.maxModule=1)}for(var c=0;c<e.model.points.length;c++){var l=e.model.points[c];if(0!=l.xForce||0!=l.yForce||0!=l.zForce){var d=l.xForce,u=l.yForce,p=l.zForce,m=Math.sqrt(Math.pow(d,2)+Math.pow(u,2)+Math.pow(p,2))-.1,f=new THREE.Vector3(d/(m+.1),u/(m+.1),p/(m+.1));m+=.1;var g=n();m=m*e.fuerzas.escala.maxModule/g,m*=e.fuerzas.escala.factorEscala;var h=e.fuerzas.escala.maxModule*e.fuerzas.escala.factorEscala/g,E=new THREE.Vector3(l.coords.x-d*h,l.coords.y-u*h,l.coords.z-p*h),v=new THREE.ArrowHelper(f,E,m,736023);0!=l.forceArrowId&&o.removeObjectById(l.forceArrowId,e.scene),l.forceArrowId=v.id,e.scene.add(v)}}e.render()}else{for(var c=0;c<e.model.points.length;c++){var l=e.model.points[c];0!=l.forceArrowId&&o.hideShowObject(l.forceArrowId,!1,e.scene)}e.render()}},e.toggleSupports=function(){if(e.statusSupports.visible){for(var t=0;t<e.model.points.length;t++){var n=e.model.points[t],a=0;0==parseFloat(n.xCondicion)&&(0!=n.supportXId&&o.removeObjectById(n.supportXId,e.scene),a=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!0,!1,!1,e.scene),n.supportXId=a),0==parseFloat(n.yCondicion)&&(0!=n.supportYId&&o.removeObjectById(n.supportYId,e.scene),a=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!1,!0,!1,e.scene),n.supportYId=a),0==parseFloat(n.zCondicion)&&(0!=n.supportZId&&o.removeObjectById(n.supportZId,e.scene),a=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!1,!1,!0,e.scene),n.supportZId=a)}e.render()}else{for(var t=0;t<e.model.points.length;t++){var n=e.model.points[t];0!=n.supportXId&&o.hideShowObject(n.supportXId,!1,e.scene),0!=n.supportYId&&o.hideShowObject(n.supportYId,!1,e.scene),0!=n.supportZId&&o.hideShowObject(n.supportZId,!1,e.scene)}e.render()}},e.toggleSprings=function(){if(e.statusSprings.visible)for(var t=0;t<e.model.points.length;t++){var n=e.model.points[t],a=0;0!=parseFloat(n.xSpring)&&0!=parseFloat(n.xCondicion)&&(0!=n.springXId&&o.removeObjectById(n.springXId,e.scene),a=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!0,!1,!1,e.scene,!0),n.springXId=a),0!=parseFloat(n.ySpring)&&0!=parseFloat(n.yCondicion)&&(0!=n.springYId&&o.removeObjectById(n.springYId,e.scene),IdSpring=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!1,!0,!1,e.scene,!0),n.springYId=IdSpring),0!=parseFloat(n.zSpring)&&0!=parseFloat(n.zCondicion)&&(0!=n.springZId&&o.removeObjectById(n.springZId,e.scene),IdSpring=o.drawPyramidSupport(n.coords.x,n.coords.y,n.coords.z,!1,!1,!0,e.scene,!0),n.springZId=IdSpring)}else for(var t=0;t<e.model.points.length;t++){var n=e.model.points[t];0!=n.springXId&&o.hideShowObject(n.springXId,!1,e.scene),0!=n.springYId&&o.hideShowObject(n.springYId,!1,e.scene),0!=n.springZId&&o.hideShowObject(n.springZId,!1,e.scene)}},$(function(){$("#toggle-event").change(function(){e.toggleForces()}),$(".toggle-event2").change(function(){e.toggleSupports()}),$(".toggle-event3").change(function(){e.toggleSprings()})}),e.toggleForces(),e.toggleSupports(),e.toggleSprings()}]),angular.module("IETFEM").factory("DefaultsService",[function(){var e=null,t=null,o=new THREE.SphereGeometry(.1,4,4),n=new THREE.SphereGeometry(.15,4,4),a=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.15}),r=new THREE.MeshBasicMaterial({color:0}),i=new THREE.MeshBasicMaterial({color:33994}),s=new THREE.MeshBasicMaterial({color:559624}),c=new THREE.MeshBasicMaterial({color:9109504}),l=function(){return a},d=function(){return r},u=function(){return i},p=function(){return s},m=function(){return c},f=function(){return o},g=function(){return n},h=function(){return e},E=function(){return t},v=function(t){e=t},x=function(e){t=e};return{getLineMaterial:h,getLineSection:E,setLineMaterial:v,setLineSection:x,getEsferaEstandar:f,getEsferaGrande:g,getMaterialGrilla:l,getMaterialNegro:d,getMaterialResaltado:u,getMaterialSeleccion:p,getMaterialCreacionLinea:m}}]),angular.module("IETFEM").factory("DeformedService",["SpaceService",function(e){var t=function(e,t){for(var o=0;o<t.points.length;o++)if(t.points[o].id==e)return t.points[o]},o=function(e,t){for(var o=0;o<t.lines.length;o++)if(t.lines[o].sceneId==e)return t.lines[o]},n=function(e,t,o,n,a,r,i,s,c){var l={};l.id=i,l.sceneId=s,l.coords={x:e,y:t,z:o},l.displacements={x:n,y:a,z:r},c.points.push(l)},a=function(e,t,o,n,a,r,i,s){var c={};c.id=o,c.sceneId=n,c.start=e,c.end=t,c.deformation=a,c.force=r,c.tension=i,s.lines.push(c)},r=function(t,o,n){if(o.points.length>0){for(var a=0;a<o.points.length;a++)e.setMaterial(o.points[a].sceneId,t,n);for(var a=0;a<o.lines.length;a++)e.setMaterial(o.lines[a].sceneId,t,n)}},i=function(t,o){if(o.points.length>0){var n=e.getMaterial(o.points[0].sceneId,t);n=new THREE.MeshBasicMaterial({color:n.color});for(var a=0;a<o.points.length;a++)e.setMaterial(o.points[a].sceneId,t,n);for(var a=0;a<o.lines.length;a++)e.setMaterial(o.lines[a].sceneId,t,n)}},s=function(t,o){for(var n=new THREE.MeshBasicMaterial({color:2689162,transparent:!0,opacity:.15}),a=0;a<o.points.length;a++)e.setMaterial(o.points[a].sceneId,t,n);for(var a=0;a<o.lines.length;a++)e.setMaterial(o.lines[a].sceneId,t,n)},c=function(t,o){material=new THREE.MeshBasicMaterial({color:2689162,transparent:!0,opacity:0});for(var n=0;n<o.points.length;n++)e.setMaterial(o.points[n].sceneId,t,material);for(var n=0;n<o.lines.length;n++)e.setMaterial(o.lines[n].sceneId,t,material)},l=function(o,n,a,r){for(var i=(new THREE.MeshBasicMaterial({color:0}),0);i<n.points.length;i++){var s=parseFloat(n.points[i].coords.x)+parseFloat(n.points[i].displacements.x)*parseFloat(r),c=parseFloat(n.points[i].coords.y)+parseFloat(n.points[i].displacements.y)*parseFloat(r),l=parseFloat(n.points[i].coords.z)+parseFloat(n.points[i].displacements.z)*parseFloat(r);e.movePoint(n.points[i].sceneId,o,s,c,l)}for(var i=0;i<n.lines.length;i++){var d=t(n.lines[i].start,n),u=t(n.lines[i].end,n),p=parseFloat(d.coords.x)+parseFloat(d.displacements.x)*parseFloat(r),m=parseFloat(d.coords.y)+parseFloat(d.displacements.y)*parseFloat(r),f=parseFloat(d.coords.z)+parseFloat(d.displacements.z)*parseFloat(r),g=parseFloat(u.coords.x)+parseFloat(u.displacements.x)*parseFloat(r),h=parseFloat(u.coords.y)+parseFloat(u.displacements.y)*parseFloat(r),E=parseFloat(u.coords.z)+parseFloat(u.displacements.z)*parseFloat(r);n.lines[i].sceneId=e.moveLine(n.lines[i].sceneId,o,p,m,f,g,h,E)}};return{getDeformedPointById:t,getDeformedLineById:o,addPointToDeformed:n,addLineToDeformed:a,setDeformedMaterial:r,setDeformedTransparent:s,setDeformedOpaque:i,hideDeformed:c,scaleDeformed:l}}]),angular.module("IETFEM").factory("leftMenuService",[function(){var e=!1,t=!1,o=!1,n=!1,a=!1,r=null;return{getAddingLines:function(){return e},getAddingNodes:function(){return t},getAddingGrillas:function(){return o},getSelecting:function(){return a},getViewOptions:function(e){return n},setSelecting:function(e){a=e},setAddingGrillas:function(e){o=e},setAddingLines:function(t){e=t},setAddingNodes:function(e){t=e},setViewOptions:function(e){n=e},getLastSelected:function(){return r},setLastSelected:function(e){r=e}}}]),angular.module("IETFEM").factory("LineaSelecService",["leftMenuService",function(e){var t,o,n={id:0,sceneId:0,material:0,section:0,start:0,end:0};return{getLineaReal:function(){return t},getLinea:function(){return n},setLinea:function(o){t=o,n.id=o.id,n.sceneId=o.sceneId,n.material=o.material,n.section=o.section,n.start=o.start,n.end=o.end,e.setLastSelected("LINEA")},setInfoLineaForm:function(e){o=e},resetLineaSeleccionada:function(){n.id=0,n.sceneId=0,n.materiales=0,n.sections=0,n.start=0,n.end=0},resetForm:function(){"undefined"!=typeof o&&o.$setPristine()}}}]),angular.module("IETFEM").factory("ModelService",["DefaultsService","SpaceService",function(e,t){var o=function(e){for(var t=0,o=0;o<e.points.length;o++)e.points[o].id>t&&(t=e.points[o].id);return t+1},n=function(e){for(var t=0,o=0;o<e.lines.length;o++)e.lines[o].id>t&&(t=e.lines[o].id);return t+1},a=function(e){for(var t=0,o=0;o<e.materiales.length;o++)e.materiales[o].id>t&&(t=e.materiales[o].id);return t+1},r=function(e){for(var t=0,o=0;o<e.secciones.length;o++)e.secciones[o].id>t&&(t=e.secciones[o].id);return t+1},i=function(e,t,o,n){for(var a=0,r=0;r<n.points.length;r++)n.points[r].coords.x==e&&n.points[r].coords.y==t&&n.points[r].coords.z==o&&(a=n.points[r].id);return a},s=function(e,t){for(var o=0;o<t.points.length;o++)if(t.points[o].id==e)return t.points[o]},c=function(e,t){for(var o=0;o<t.lines.length;o++)if(t.lines[o].id==e)return t.lines[o]},l=function(e,t){for(var o=0;o<t.points.length;o++)if(t.points[o].sceneId==e)return t.points[o]},d=function(e,t){for(var o=0;o<t.lines.length;o++)if(t.lines[o].sceneId==e)return t.lines[o]},u=function(e,t,n,a,r){var i={};i.id=o(r),i.sceneId=a,i.xCondicion="F",i.yCondicion="F",i.zCondicion="F",i.xForce=0,i.yForce=0,i.zForce=0,i.xSpring=0,i.ySpring=0,i.zSpring=0,i.coords={x:e,y:t,z:n},i.forceArrowId=0,i.supportXId=0,i.supportYId=0,i.supportZId=0,i.springXId=0,i.springYId=0,i.springZId=0,r.points.push(i)},p=function(t,o,a,r,s,c,l,d){var u={};u.id=n(d),u.sceneId=l,null!=e.getLineMaterial()&&(u.material=e.getLineMaterial().id),null!=e.getLineSection()&&(u.section=e.getLineSection().id),u.start=i(t,o,a,d),u.end=i(r,s,c,d),d.lines.push(u)},m=function(e){for(var t=0,o=0;o<e.length;o++)e[o].gridId>=t&&(t=e[o].gridId);t++;var n={};return n.gridId=t,n.viewStatus=!0,n.objects=[],e.push(n),n},f=function(e,t,o,n,a){var r={};r.type="POINT",r.sceneId=n,r.coords={x:e,y:t,z:o},a.objects.push(r)},g=function(e,t,o,n,a,r,i,s){var c={};c.type="LINE",c.sceneId=i,c.start={x:e,y:t,z:o},c.end={x:n,y:a,z:r},s.objects.push(c)},h=function(e,t){for(var o=null,n=0;n<t.lines.length;n++)if(t.lines[n].id==e){o=n;break}null!=o&&t.lines.splice(o,1)},E=function(e,t){for(var o=null,n=0;n<t.length;n++)if(t[n].id==e){o=n;break}null!=o&&t.splice(o,1)},v=function(e,t){for(var o=null,n=0;n<t.points.length;n++)if(t.points[n].id==e){o=n;break}null!=o&&t.points.splice(o,1)},x=function(e,t,o,n,r,i){var s={};s.id=a(i),s.name=e,s.youngModule=t,s.gamma=o,s.alpha=n,s.nu=r,i.materiales.push(s)},M=function(e,t,o){var n={};n.id=r(o),n.name=e,n.section=t,o.secciones.push(n)},y=function(e,t,o,n){for(var a=0;a<n.points.length;a++)if(n.points[a].coords.x==e&&n.points[a].coords.y==t&&n.points[a].coords.z==o)return!0;return!1},I=function(e){var t,o=[],n=[];t="Input for a 3D with large deformation (You must respect line breaks):\n\nForce Magnitude\n"+e.unitForce+"\n\nLength Magnitude\n"+e.unitLength+"\n\nNumber of degrees of freedom per node\n3\n\nNumber of nodes per element\n2\n\n",t+="Number of materials\n"+e.materiales.length+"\n\n",t+="Materials:\nYoung Modulus	gamma	alpha (1/C)	nu\n";for(var a=0;a<e.materiales.length;a++)t+=e.materiales[a].youngModule+"	"+e.materiales[a].gamma+"	"+e.materiales[a].alpha+"	"+e.materiales[a].nu+"\n",o[e.materiales[a].id]=a+1;t+="\nNumber of temperature cases\n0\n\nTemperature cases:\nValue\n\n",t+="Number of sections\n"+e.secciones.length+"\n\n",t+="Sections:\nArea\n";for(var a=0;a<e.secciones.length;a++)t+=e.secciones[a].section+"\n",n[e.secciones[a].id]=a+1;t+="\nNumber of nodes\n"+e.points.length+"\n\n",t+="Node matrix \n",t+="Xs     Ys     Zs\n";for(var a=0;a<e.points.length;a++)t+=e.points[a].coords.x+"	"+e.points[a].coords.y+"	"+e.points[a].coords.z+"\n";t+="\nNumber of elements\n"+e.lines.length+"\n\n",t+="Conectivity matrix\n",t+="material     section     tempcase     start     end\n";for(var a=0;a<e.lines.length;a++)t+=o[e.lines[a].material]+"	"+n[e.lines[a].section]+"	0	"+e.lines[a].start+"	"+e.lines[a].end+"\n";for(var r=[],a=0;a<e.points.length;a++)("F"!=e.points[a].xCondicion||"F"!=e.points[a].yCondicion||"F"!=e.points[a].zCondicion)&&r.push(e.points[a]);t+="\nNumber of displacement conditions nodes\n"+r.length+"\n\nDisplacement conditions nodes matrix\nDisplacement node  X condition   Y condition   Z condition\n";for(var a=0;a<r.length;a++)t+=r[a].id+"	"+r[a].xCondicion+"	"+r[a].yCondicion+"	"+r[a].zCondicion+"\n";for(var i=[],a=0;a<e.points.length;a++)(0!=e.points[a].xForce||0!=e.points[a].yForce||0!=e.points[a].zForce)&&i.push(e.points[a]);t+="\nNumber of puntual load conditions\n"+i.length+"\n\nPuntual loads conditions nodes matrix\nLoad node       FX            FY           FZ\n";for(var a=0;a<i.length;a++)t+=i[a].id+"	"+i[a].xForce+"	"+i[a].yForce+"	"+i[a].zForce+"\n";t+="\nNumber of dead volume load conditions\n0\n\nDead volume loads conditions matrix\nElement           bx                  by                  bz\n";for(var s=[],a=0;a<e.points.length;a++)(0!=e.points[a].xSpring||0!=e.points[a].ySpring||0!=e.points[a].zSpring)&&s.push(e.points[a]);t+="\nNumber of springs conditions nodes\n"+s.length+"\n\nSprings conditions nodes matrix\nSpring node  X condition   Y condition   Z condition \n";for(var a=0;a<s.length;a++)t+=s[a].id+"	"+s[a].xSpring+"	"+s[a].ySpring+"	"+s[a].zSpring+"\n";return t},w=function(e){var t={valid:!0,emptyStructure:!1,invalidStructure:!1};0==e.lines.length&&(t.emptyStructure=!0,t.valid=!1);for(var o=0;o<e.lines.length;o++)e.lines[o].material&&e.lines[o].section||(t.invalidStructure=!0,t.valid=!1);return t},S=function(e,o,n){for(var a=0;a<o.points.length;a++)t.setMaterial(o.points[a].sceneId,e,n);for(var a=0;a<o.lines.length;a++)t.setMaterial(o.lines[a].sceneId,e,n)},F=function(e,o){if(o.points.length>0){var n=t.getMaterial(o.points[0].sceneId,e);n=new THREE.MeshBasicMaterial({color:n.color});for(var a=0;a<o.points.length;a++)t.setMaterial(o.points[a].sceneId,e,n);for(var a=0;a<o.lines.length;a++)t.setMaterial(o.lines[a].sceneId,e,n)}},b=function(e,o){if(o.points.length>0){var n=t.getMaterial(o.points[0].sceneId,e);n=new THREE.MeshBasicMaterial({color:n.color,transparent:!0,opacity:.15});for(var a=0;a<o.points.length;a++)t.setMaterial(o.points[a].sceneId,e,n);for(var a=0;a<o.lines.length;a++)t.setMaterial(o.lines[a].sceneId,e,n)}},T=function(e,o,n,a,r){var i,s,c,l;if(c=0,l=9999,"normal"!=a)for(var d=0;d<o.lines.length;d++)switch(a){case"deformation":n.lines[d].deformation>c&&(c=n.lines[d].deformation),n.lines[d].deformation<l&&(l=n.lines[d].deformation);break;case"force":n.lines[d].force>c&&(c=n.lines[d].force),n.lines[d].force<l&&(l=n.lines[d].force);break;case"tension":n.lines[d].tension>c&&(c=n.lines[d].tension),n.lines[d].tension<l&&(l=n.lines[d].tension)}for(var d=0;d<o.lines.length;d++){switch(a){case"normal":i=0;break;case"deformation":if(s=0,n.lines[d].deformation>0)for(var u=0;c>=u;u+=c/5)n.lines[d].deformation>u&&(s+=1);else{for(var u=0;-l>=u;u+=-l/5)-n.lines[d].deformation>u&&(s+=1);s=-s}i=t.getColor(s);break;case"force":if(s=0,n.lines[d].force>0)for(var u=0;c>=u;u+=c/5)n.lines[d].force>u&&(s+=1);else{for(var u=0;-l>=u;u+=-l/5)-n.lines[d].force>u&&(s+=1);s=-s}i=t.getColor(s);break;case"tension":if(s=0,n.lines[d].tension>0)for(var u=0;c>=u;u+=c/5)n.lines[d].tension>u&&(s+=1);else{for(var u=0;-l>=u;u+=-l/5)-n.lines[d].tension>u&&(s+=1);s=-s}i=t.getColor(s)}if(r)var p=new THREE.MeshBasicMaterial({color:i,transparent:!0,opacity:.15});else var p=new THREE.MeshBasicMaterial({color:i});t.setMaterial(o.lines[d].sceneId,e,p)}};return{addMaterial:x,addSection:M,getPointById:s,getLineById:c,getPointBySceneId:l,getLineBySceneId:d,getPointIdByCoords:i,removeLineFromModel:h,removeObjFromArray:E,removePointFromModel:v,addPointToModel:u,addLineToModel:p,isInModel:y,getText:I,validModel:w,setModelMaterial:S,setModelTransparent:b,setModelOpaque:F,addGridLineToModel:g,addGridPointToModel:f,createGridInfo:m,colorizeModel:T}}]),angular.module("IETFEM").factory("PtoSelecService",["leftMenuService",function(e){var t,o,n={id:0,sceneId:0,xCondicion:"F",yCondicion:"F",zCondicion:"F",xForce:0,yForce:0,zForce:0,xSpring:0,ySpring:0,zSpring:0,forceArrowId:0,coords:{x:0,y:0,z:0}};return{getPuntoReal:function(){return t},getPunto:function(){return n},setPunto:function(o,a){t=o,n.id=o.id,n.sceneId=o.sceneId,n.xCondicion=o.xCondicion,n.yCondicion=o.yCondicion,n.zCondicion=o.zCondicion,n.xForce=o.xForce,n.yForce=o.yForce,n.zForce=o.zForce,n.xSpring=o.xSpring,n.ySpring=o.ySpring,n.zSpring=o.zSpring,n.coords=o.coords,n.forceArrowId=o.forceArrowId,e.setLastSelected("NODO")},setInfoPuntoForm:function(e){o=e},resetPuntoSeleccionado:function(){n.id=0,n.sceneId=0,n.xCondicion="F",n.yCondicion="F",n.zCondicion="F",n.xForce=0,n.yForce=0,n.zForce=0,n.xSpring=0,n.ySpring=0,n.zSpring=0,n.coords={x:0,y:0,z:0}},resetForm:function(){"undefined"!=typeof o&&o.$setPristine()}}}]),angular.module("IETFEM").factory("SpaceService",["DefaultsService",function(e){var t=[{index:-5,color:6359819},{index:-4,color:11797508},{index:-3,color:16711680},{index:-2,color:16406616},{index:-1,color:16099753},{index:0,color:3054334},{index:1,color:11138473},{index:2,color:5831256},{index:3,color:65280},{index:4,color:308228},{index:5,color:745739}],o=[],n=function(e,t,n,a,r){var i=(new THREE.Vector3).subVectors(t,e),s=new THREE.Matrix4;s.lookAt(e,t,(new THREE.Object3D).up);var c=new THREE.Matrix4;c.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),s.multiply(c);var l,d=$.grep(o,function(e){return e.largo==i.length()});d.length>0&&r?l=d[0].geometry:(l=new THREE.CylinderGeometry(a,a,i.length(),3,1),o.push({largo:i.length(),geometry:l}));var u=new THREE.Mesh(l,n);return u.applyMatrix(s),u.applyMatrix((new THREE.Matrix4).makeTranslation((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)),u},a=function(e,t,o,n){var a=(new THREE.Vector3).subVectors(t,e),r=new THREE.Matrix4;r.lookAt(e,t,(new THREE.Object3D).up);var i=new THREE.Matrix4;i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),r.multiply(i);var s=new THREE.CylinderGeometry(.1,0,a.length(),4),c=new THREE.Mesh(s,o);return c.applyMatrix(r),c.applyMatrix((new THREE.Matrix4).makeTranslation((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)),c},r=function(e,t,o,a,r,i,s,c,l,d,u){var p=n(new THREE.Vector3(e,t,o),new THREE.Vector3(a,r,i),s,c,u);return l.add(p),null!=d&&d.push(p),p.id},s=function(t,o,n,a,r,i,s){var c=e.getEsferaEstandar(),l=new THREE.Mesh(c,i);return l.position.x=t,l.position.y=o,l.position.z=n,a.add(l),r.push(l),null!=s&&s.push(l),l.id},c=function(e,t,o,n,r,i,s,c){var l;if(l=c?new THREE.MeshBasicMaterial({color:5796466}):new THREE.MeshBasicMaterial({color:723809}),n){if(e>=0)var d=a(new THREE.Vector3(e-.1,t,o),new THREE.Vector3(e-.3,t,o),l,2);else var d=a(new THREE.Vector3(e+.1,t,o),new THREE.Vector3(e+.3,t,o),l,2);return s.add(d),d.id}if(r){if(t>=0)var d=a(new THREE.Vector3(e,t-.1,o),new THREE.Vector3(e,t-.3,o),l,2);else var d=a(new THREE.Vector3(e,t+.1,o),new THREE.Vector3(e,t+.3,o),l,2);return s.add(d),d.id}if(i){if(o>=0)var d=a(new THREE.Vector3(e,t,o-.1),new THREE.Vector3(e,t,o-.3),l,2);else var d=a(new THREE.Vector3(e,t,o+.1),new THREE.Vector3(e,t,o+.3),l,2);return s.add(d),d.id}},l=function(t,o,n,a,c){var l=e.getMaterialNegro(),d={},u={};for(i=0;i<o.points.length;i++)o.points[i].sceneId=s(o.points[i].coords.x,o.points[i].coords.y,o.points[i].coords.z,t,n,l,null);for($("#toggle-event").click(),$("#toggle-event").click(),$("#toggle-event2").click(),$("#toggle-event2").click(),i=0;i<o.lines.length;i++){for(j=0;j<o.points.length;j++)o.lines[i].start==o.points[j].id&&(d.x=o.points[j].coords.x,d.y=o.points[j].coords.y,d.z=o.points[j].coords.z),o.lines[i].end==o.points[j].id&&(u.x=o.points[j].coords.x,u.y=o.points[j].coords.y,u.z=o.points[j].coords.z);o.lines[i].sceneId=r(d.x,d.y,d.z,u.x,u.y,u.z,l,.05,t,a)}},d=function(e,t){for(var o=null,n=0;n<t.children.length;n++)t.children[n]instanceof THREE.Mesh&&t.children[n].id==e&&(o=t.children[n]);return o},u=function(e,t){for(var o=0;o<t.children.length;o++)if(t.children[o]instanceof THREE.Mesh&&t.children[o].id==e)return t.children[o]},p=function(e,t,o,n){for(var a=0,r=0;r<n.children.length;r++)n.children[r]instanceof THREE.Mesh&&null==d(r,n)&&n.children[r].position.x==e&&n.children[r].position.y==t&&n.children[r].position.z==o&&(a=n.children[r].id);return a},m=function(e,t){return d(e,t).material},f=function(e,t,o){d(e,t).material=o},g=function(e,t,o,n,a){d(e,t).position.x=o,d(e,t).position.y=a,d(e,t).position.z=n},h=function(e,t,o,a,r,i,s,c){var l=m(e,t),d=n(new THREE.Vector3(o,r,a),new THREE.Vector3(i,c,s),l,.05,!1);t.add(d);for(var u=0;u<t.children.length;u++)t.children[u]instanceof THREE.Mesh&&t.children[u].id==e&&t.remove(t.children[u]);return t.children[t.children.length-1].id},E=function(e,t,o){var n=o.getObjectById(e,!0);null!=n&&(n.visible=t)},v=function(e,t){var o=t.getObjectById(e,!0);t.remove(o)},x=function(e){for(var o=0;o<t.length;o++)if(t[o].index===e)return t[o].color};return{drawLine:r,drawPoint:s,drawPyramidSupport:c,drawModel:l,getSceneLineById:u,getScenePointById:d,getScenePointIdByCoords:p,getMaterial:m,setMaterial:f,movePoint:g,moveLine:h,hideShowObject:E,removeObjectById:v,getColor:x}}]),THREE.OrbitControls=function(e,t){function o(){return 2*Math.PI/60/60*f.autoRotateSpeed}function n(){return Math.pow(.95,f.zoomSpeed)}function a(e){if(f.enabled!==!1){if(e.preventDefault(),e.button===f.mouseButtons.ORBIT){if(f.noRotate===!0)return;O=L.ROTATE,h.set(e.clientX,e.clientY)}else if(e.button===f.mouseButtons.ZOOM){if(f.noZoom===!0)return;O=L.DOLLY,S.set(e.clientX,e.clientY)}else if(e.button===f.mouseButtons.PAN){if(f.noPan===!0)return;O=L.PAN,x.set(e.clientX,e.clientY)}O!==L.NONE&&(document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",i,!1),f.dispatchEvent(X))}}function r(e){if(f.enabled!==!1){e.preventDefault();var t=f.domElement===document?f.domElement.body:f.domElement;if(O===L.ROTATE){if(f.noRotate===!0)return;E.set(e.clientX,e.clientY),v.subVectors(E,h),f.rotateLeft(2*Math.PI*v.x/t.clientWidth*f.rotateSpeed),f.rotateUp(2*Math.PI*v.y/t.clientHeight*f.rotateSpeed),h.copy(E)}else if(O===L.DOLLY){if(f.noZoom===!0)return;F.set(e.clientX,e.clientY),b.subVectors(F,S),b.y>0?f.dollyIn():b.y<0&&f.dollyOut(),S.copy(F)}else if(O===L.PAN){if(f.noPan===!0)return;M.set(e.clientX,e.clientY),y.subVectors(M,x),f.pan(y.x,y.y),x.copy(M)}O!==L.NONE&&f.update()}}function i(){f.enabled!==!1&&(document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",i,!1),f.dispatchEvent(Y),O=L.NONE)}function s(e){if(f.enabled!==!1&&f.noZoom!==!0&&O===L.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?f.dollyOut():0>t&&f.dollyIn(),f.update(),f.dispatchEvent(X),f.dispatchEvent(Y)}}function c(e){if(f.enabled!==!1&&f.noKeys!==!0&&f.noPan!==!0)switch(e.keyCode){case f.keys.UP:f.pan(0,f.keyPanSpeed),f.update();break;case f.keys.BOTTOM:f.pan(0,-f.keyPanSpeed),f.update();break;case f.keys.LEFT:f.pan(f.keyPanSpeed,0),f.update();break;case f.keys.RIGHT:f.pan(-f.keyPanSpeed,0),f.update()}}function l(e){if(f.enabled!==!1){switch(e.touches.length){case 1:if(f.noRotate===!0)return;O=L.TOUCH_ROTATE,h.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(f.noZoom===!0)return;O=L.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);S.set(0,n);break;case 3:if(f.noPan===!0)return;O=L.TOUCH_PAN,x.set(e.touches[0].pageX,e.touches[0].pageY);break;default:O=L.NONE}O!==L.NONE&&f.dispatchEvent(X)}}function d(e){if(f.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=f.domElement===document?f.domElement.body:f.domElement;switch(e.touches.length){case 1:if(f.noRotate===!0)return;if(O!==L.TOUCH_ROTATE)return;E.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(E,h),f.rotateLeft(2*Math.PI*v.x/t.clientWidth*f.rotateSpeed),f.rotateUp(2*Math.PI*v.y/t.clientHeight*f.rotateSpeed),h.copy(E),f.update();break;case 2:if(f.noZoom===!0)return;if(O!==L.TOUCH_DOLLY)return;var o=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(o*o+n*n);F.set(0,a),b.subVectors(F,S),b.y>0?f.dollyOut():b.y<0&&f.dollyIn(),S.copy(F),f.update();break;case 3:if(f.noPan===!0)return;if(O!==L.TOUCH_PAN)return;M.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(M,x),f.pan(y.x,y.y),x.copy(M),f.update();break;default:O=L.NONE}}}function u(){f.enabled!==!1&&(f.dispatchEvent(Y),O=L.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var p,m,f=this,g=1e-6,h=new THREE.Vector2,E=new THREE.Vector2,v=new THREE.Vector2,x=new THREE.Vector2,M=new THREE.Vector2,y=new THREE.Vector2,I=new THREE.Vector3,w=new THREE.Vector3,S=new THREE.Vector2,F=new THREE.Vector2,b=new THREE.Vector2,T=0,z=0,R=1,H=new THREE.Vector3,P=new THREE.Vector3,j=new THREE.Quaternion,L={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},O=L.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var A=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),C=A.clone().inverse(),N={type:"change"},X={type:"start"},Y={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=o()),z-=e},this.rotateUp=function(e){void 0===e&&(e=o()),T-=e},this.panLeft=function(e){var t=this.object.matrix.elements;I.set(t[0],t[1],t[2]),I.multiplyScalar(-e),H.add(I)},this.panUp=function(e){var t=this.object.matrix.elements;I.set(t[4],t[5],t[6]),I.multiplyScalar(e),H.add(I)},this.pan=function(e,t){var o=f.domElement===document?f.domElement.body:f.domElement;if(f.object instanceof THREE.PerspectiveCamera){var n=f.object.position,a=n.clone().sub(f.target),r=a.length();r*=Math.tan(f.object.fov/2*Math.PI/180),f.panLeft(2*e*r/o.clientHeight),f.panUp(2*t*r/o.clientHeight)}else f.object instanceof THREE.OrthographicCamera?(f.panLeft(e*(f.object.right-f.object.left)/o.clientWidth),f.panUp(t*(f.object.top-f.object.bottom)/o.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=n()),f.object instanceof THREE.PerspectiveCamera?R/=e:f.object instanceof THREE.OrthographicCamera?(f.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),f.object.updateProjectionMatrix(),f.dispatchEvent(N)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=n()),f.object instanceof THREE.PerspectiveCamera?R*=e:f.object instanceof THREE.OrthographicCamera?(f.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),f.object.updateProjectionMatrix(),f.dispatchEvent(N)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var e=this.object.position;w.copy(e).sub(this.target),w.applyQuaternion(A),p=Math.atan2(w.x,w.z),m=Math.atan2(Math.sqrt(w.x*w.x+w.z*w.z),w.y),this.autoRotate&&O===L.NONE&&this.rotateLeft(o()),p+=z,m+=T,p=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,p)),m=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,m)),m=Math.max(g,Math.min(Math.PI-g,m));var t=w.length()*R;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(H),w.x=t*Math.sin(m)*Math.sin(p),w.y=t*Math.cos(m),w.z=t*Math.sin(m)*Math.cos(p),w.applyQuaternion(C),e.copy(this.target).add(w),this.object.lookAt(this.target),z=0,T=0,R=1,H.set(0,0,0),(P.distanceToSquared(this.object.position)>g||8*(1-j.dot(this.object.quaternion))>g)&&(this.dispatchEvent(N),P.copy(this.object.position),j.copy(this.object.quaternion))},this.reset=function(){O=L.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(N),this.update()},this.getPolarAngle=function(){return m},this.getAzimuthalAngle=function(){return p},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",c,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;var THREEx=THREEx||{};THREEx.RendererStats=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer";var t=document.createElement("div");t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;",e.appendChild(t);var o=document.createElement("div");o.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",o.innerHTML="WebGLRenderer",t.appendChild(o);for(var n=[],a=9,r=0;a>r;r++)n[r]=document.createElement("div"),n[r].style.cssText="color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",t.appendChild(n[r]),n[r].innerHTML="-";var i=Date.now();return{domElement:e,update:function(e){if(console.assert(e instanceof THREE.WebGLRenderer),!(Date.now()-i<1e3/30)){i=Date.now();var t=0;n[t++].textContent="== Memory =====",n[t++].textContent="Programs: "+e.info.memory.programs,n[t++].textContent="Geometries: "+e.info.memory.geometries,n[t++].textContent="Textures: "+e.info.memory.textures,n[t++].textContent="== Render =====",n[t++].textContent="Calls: "+e.info.render.calls,n[t++].textContent="Vertices: "+e.info.render.vertices,n[t++].textContent="Faces: "+e.info.render.faces,n[t++].textContent="Points: "+e.info.render.points}}}};